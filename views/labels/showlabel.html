{{extend 'layout.html'}}

<script type="text/javascript">
var t = {{=XML(response.json(testsuiteArray))}}
console.log(t)

for(var i=0;i<t.length;i++){
        var obj = t[i];
        for(var key in obj){
            var attrName = key;
            var attrValue = obj[key];

            var tableId = "analysistable"+i
            var analyzeButtonid = "Save"+i
            var analyzeButtonName = "Save"
            var analyzeButtonStyle = "analyzeButton btn btn-primary"
            var dataTableHandler = "/web2py_birt/fact/analyzeHandler"

            var tableColumns = [
              { "sTitle": "Select", "bSortable": false ,"sWidth": "1%","mData" : null,
                "sDefaultContent": '<input type = "checkbox">'},
              { "sTitle": "Testcase name","sWidth": "10%","mData" : "testdescription.name"},
              { "sTitle": "Testcase description","bSortable": false,"sWidth": "90%", "mData": "testdescription.testdescription" },
              { "sTitle": "Status","sWidth": "10%", "mData": "testresult.testresult" },
              { "sTitle": "Error description", "bSortable": false,"sWidth": "20%", "mData": "testresult.failuredescription" },
              { "sTitle": "Bug type","sWidth": "10%", "mData": "analysis.errortype" },
              { "sTitle": "Jira Id","sWidth": "20%", "mData": "analysis.elvis_id" },
              { "sTitle": "Comment", "bSortable": false,"sWidth": "20%", "mData": "analysis.comment" },
              { "sTitle": "Testresult id", "bVisible" : false, "mData" : "testresult.id"}
              ]

            var sorting = [[ 3,"asc" ]]
            var table = new DataTable();
            table.addDataTable(tableId,tableColumns,sorting,dataTableHandler,[analyzeButtonid],attrValue);
            table.addButton(analyzeButtonid,tableId,analyzeButtonStyle,"button",analyzeButtonName);
            table.addMultiClickRawHandler([analyzeButtonid],tableId);
            table.addSaveButtonAjaxHandler(analyzeButtonid);
            table.addFiltering(tableId);
            table.testsuiteid = attrValue


            // MyApp.addDataTable(tableId,tableColumns,sorting,dataTableHandler,[analyzeButtonid],attrValue);
            // MyApp.addButton(analyzeButtonid,tableId,analyzeButtonStyle);
            // MyApp.addMultiClickRawHandler([analyzeButtonid],tableId);
            // MyApp.addSaveButtonHandler();
            // MyApp.addFiltering();
            // MyApp.testsuiteid = attrValue
        }
    }


</script>

<div id="demo">
<form id="form" method = "POST" action = "/web2py_birt/fact/saveAnalyze">

  <div class="accordion" id="accordion2">
    {{for i in range(len(testsuiteArray)):}}
        <div class="accordion-group">
        <div class="accordion-heading">
        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne{{=i}}">
        Collapsible Group Item #1
        </a>
        </div>
        <div id="collapseOne{{=i}}" class="collapse">
        <div class="accordion-inner">
      <table cellpadding="0" cellspacing="0" border="0" class="display" id="analysistable{{=i}}">
        <tbody width="100%">
          <tr>
            <td colspan="55" class="dataTables_empty">Loading data from server</td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <th><input type="hidden" name="search_id" class="search_init_focus_of"/></th>
            <th><input type="text" name="search_name" value="Search" class="search_init_focus_of" /></th>
            <th><input type="hidden" name="search_desc" value="Search" class="search_init_focus_of" /></th>
            <th><input type="hidden" name="search_status" value="Search" class="search_init_focus_of" /></th>
            <th><input type="hidden" name="search_error" value="Search" class="search_init_focus_of" /></th>
            <th><input type="hidden"  value="Search" class="search_init_focus_of" /></th>
            <th><input type="text" name="search_jira" value="Search" class="search_init_focus_of" /></th>
            <th><input type="hidden" name="search_coment" value="Search" class="search_init_focus_of" /></th>
            <th></th>
          </tr>
        </tfoot>
      </table>
        </div>
        </div>
        </div>
   {{pass}}
  </div>

 
</form>
</div>

